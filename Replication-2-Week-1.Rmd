---
title: 'Replication #2'
author: "Jack Schroeder"
date: "2/18/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# Begin by calling for Enos' libraries.

library(ri)
library(RItools)
library(car)
library(xtable)
library(effects)
library(RColorBrewer)
library(tidyverse)
library(kableExtra)

# Enos had this in to set scientific notation.

options(scipen = 999)  

# This code will load in the data for the paper.

dat.all <- read.csv('pnas_data.csv')
dat.t1 <- read.csv('t1_data.csv')
dat.all.prime <- read.csv('prime_data.csv')
conf.dat <- read.csv('confederate_face_data.csv')
hisp.dat <- read.csv('hispanic_face_data.csv')
white.dat <- read.csv('white_face_data.csv')

```

```{r balance test, echo=FALSE}
# Starting with the balance check data. Run the balance checks (with cleaned-up code).

out.balance.test <- xBalance(fmla = treatment ~ liberal + republican + obama.disapprove + ride.everyday + voted.2010 + romney.voter + Hispanics.x + age + residency.new + hispanic.new + college + income.new + male + white, data = dat.all, report = c("std.diffs","z.scores","adj.means"), strata = factor(dat.all$station))

# Xtable works for creating tables but I prefer Kable.

out.balance.test %>% 
  kable(caption = "Table 2. Covariate balance across treatment conditions", col.names = c("Control", "Treatment", "Standard difference*", "Z-score", "^+"), digits=2) %>% 
  footnote(symbol = c("Difference in Standardized Units", "Unclear what column this actually is, but it appears in the output and not the final table"))

# The following code chunks run the missing balance tests. We cleaned them up, but they do not
# appear in the paper.

missing.balance.test.1 <- xBalance(fmla = missing ~ liberal + republican + obama.disapprove + ride.everyday + voted.2010 + romney.voter + Hispanics + age + residency.new + hispanic.new +  gender + college + us.born + income.new + male, data = dat.t1, report = c("std.diffs","z.scores","adj.means","chisquare.test"),na.rm=T)
#kableExtra::kable(missing.balance.test.1, caption = "Missing Balance Test #1")
missing.balance.test.2 <- xBalance(fmla = missing ~ numberim + Remain + Englishlan + liberal + republican + obama.disapprove + ride.everyday + voted.2010 + romney.voter + Hispanics + age + residency.new + hispanic.new + gender + college + us.born + income.new + male, data = dat.t1, report = c("std.diffs","z.scores","adj.means","chisquare.test"),na.rm=T)
#kableExtra::kable(missing.balance.test.2, caption = "Missing Balance Test #2")
missing.balance.test.3 <- xBalance(fmla = missing ~ treatment, data = dat.t1, report = c("std.diffs","z.scores","adj.means","chisquare.test"),na.rm=T)
#kableExtra::kable(missing.balance.test.3, caption = "Missing Balance Test #3")
```